FROM node:20-alpine AS base

RUN corepack enable pnpm

WORKDIR /app

COPY package.json pnpm-workspace.yaml pnpm-lock.yaml ./
COPY packages/core/package.json ./packages/core/
COPY packages/db/package.json ./packages/db/
COPY packages/api/package.json ./packages/api/
COPY packages/refinement-service/package.json ./packages/refinement-service/
COPY packages/web/package.json ./packages/web/

FROM base AS development

RUN pnpm install --frozen-lockfile

COPY packages/ ./packages/
COPY tsconfig.json ./

EXPOSE 3000 9229

CMD ["pnpm", "dev"]

